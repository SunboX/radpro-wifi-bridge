<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Configuration Backup &amp; Restore</title>
        <link rel="stylesheet" href="/portal/portal.css" />
    </head>
    <body class="invert">
        <div class="wrap">
            <h1>Configuration Backup &amp; Restore</h1>
            <p class="notice {{NOTICE_CLASS}}">{{NOTICE_TEXT}}</p>
            <section>
                <h2>Download Backup</h2>
                <p>Grab a JSON snapshot of the current configuration for safekeeping.</p>
                <form action="/backup.json" method="get">
                    <button type="submit">Download JSON Backup</button>
                </form>
            </section>
            <section>
                <h2>Restore From Backup</h2>
                <p>Select a previously exported JSON file. The device will apply the settings immediately.</p>
                <input type="file" id="restoreFile" accept="application/json" />
                <form id="restoreForm" action="/backup/restore" method="post">
                    <textarea id="configJsonField" name="configJson" class="hidden-field"></textarea>
                    <button type="button" id="restoreSubmit">Restore Configuration</button>
                </form>
                <p id="restoreClientMessage" class="client-msg"></p>
            </section>
            <form action="/" method="get" class="back-form">
                <button type="submit">Back to Main Menu</button>
            </form>
        </div>
        <script>
            const fileInput = document.getElementById('restoreFile')
            const hiddenField = document.getElementById('configJsonField')
            const clientMsg = document.getElementById('restoreClientMessage')
            const form = document.getElementById('restoreForm')
            const submitBtn = document.getElementById('restoreSubmit')
            submitBtn.addEventListener('click', async () => {
                clientMsg.textContent = ''
                clientMsg.classList.remove('error')
                if (!fileInput.files.length) {
                    clientMsg.textContent = 'Please choose a backup file first.'
                    clientMsg.classList.add('error')
                    return
                }
                try {
                    const text = await fileInput.files[0].text()
                    hiddenField.value = text
                    form.submit()
                } catch (err) {
                    clientMsg.textContent = 'Could not read file: ' + err.message
                    clientMsg.classList.add('error')
                }
            })
        </script>
    </body>
</html>
